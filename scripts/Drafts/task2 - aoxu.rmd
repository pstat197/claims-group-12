---
title: "task2-aoxu"
author: "AO XU"
date: "2022-11-08"
output: html_document
---

Perform a secondary tokenization of the data to obtain bigrams. Fit a logistic principal component regression model to the word-tokenized data, and then input the predicted log-odds-ratios together with some number of principal components of the bigram-tokenized data to a second logistic regression model. Based on the results, does it seem like the bigrams capture additional information about the claims status of a page?

```{r}
# setup
library(tidyverse)
library(tidytext)
library(tokenizers)
library(textstem)
library(stopwords)
```

```{r}
#load('/Users/xuao/Documents/2022Fall/Pstat197/claims-group-12/data/claims-raw.RData')
#preprocess (will take a minute or two)
#claims_clean <- claims_raw %>%
  #parse_data()
claims_clean
```
```{r}
load('/Users/xuao/Documents/2022Fall/Pstat197/claims-group-12/data/claims-raw.RData')
load('/Users/xuao/Documents/2022Fall/Pstat197/claims-group-12/data/claims-test.Rdata')
load('/Users/xuao/Documents/2022Fall/Pstat197/claims-group-12/data/claims-clean-example.Rdata')
```
```{r}
ls()
```
```{r}
# Task Two
claims_bigrams <- claims_clean %>% 
  nlp_fn2()
```

```{r}
# partition data
set.seed(198888)
# partitions <- claims_bigrams %>% initial_split(prop = 0.8)
```

```{r}
# find projections based on training data
proj_out <- projection_fn(.dtm = train_dtm, .prop = 0.7)
train_dtm_projected <- proj_out$data


train <- train_labels %>%
  transmute(bclass = factor(bclass)) %>%
  bind_cols(train_dtm_projected)

fit <- glm(bclass ~ ., data = train, 'binomial')


x_train <- train %>% select(-bclass) %>% as.matrix()
y_train <- train_labels %>% pull(bclass)
```
```{r}
# fit enet model
alpha_enet <- 0.3
fit_reg <- glmnet(x = x_train, 
                  y = y_train, 
                  family = 'binomial',
                  alpha = alpha_enet)

# choose a strength by cross-validation
set.seed(102722)
cvout <- cv.glmnet(x = x_train, 
                   y = y_train, 
                   family = 'binomial',
                   alpha = alpha_enet)

# store optimal strength
lambda_opt <- cvout$lambda.min

# view results
cvout
```






